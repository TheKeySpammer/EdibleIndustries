<%include ./partials/header %>

<div class="container">
    <section class="hero is-info welcome is-small" style="margin-bottom: 20px;">
        <div class="hero-body">
            <div class="container">
                <h1 class="title">
                    Hello, Aamir Mushtaq Siddiqui.
                </h1>
                <h2 class="subtitle">
                    Here is your daily report!
                </h2>
            </div>
        </div>
    </section>
    <div class="tile is-ancestor">
        <div class="tile is-parent">
            <div class="tile is-child box">
                <p>Sales in <%=monthName%>, <%=yearName%></p>
                <p class="title has-text-centered"><span style="font-size: 1rem;">Re.</span> <%=formatted_total%></p>
            </div>
        </div>
        <div class="tile is-parent">
            <div class="tile is-child box">
                <p>Total Assets</p>
                <p class="title has-text-centered"><span style="font-size: 1rem;">Re.</span> <%=formatted_asset%></p>
            </div>
        </div>
        <div class="tile is-parent">
            <div class="tile is-child box">
                <p>Outstanding Revenue</p>
                <p class="title has-text-centered"><span style="font-size: 1rem;">Re.</span> <%=formatted_outstanding%></p>
            </div>
        </div>
        <div class="tile is-parent">
            <div class="tile is-child box">
                <p>Rented Items</p>
                <p class="title has-text-centered"><%=formatted_rented%></p>
            </div>
        </div>
    </div>
    <div class="columns">
        <div class="column">
            <div class="box">
                <div class="columns">
                    <div class="column">
                        <p class="title is-5">Search Bill</p>
                    </div>
                    <div class="column">
                        <div class="field is-grouped is-grouped-right">
                            <div class="control">
                                <a href="/billing/add" class="button is-small is-rounded is-success">
                                    <span class="icon is-small">
                                        <i class="fas fa-plus fa-xs"></i>
                                    </span>
                                    <span>New Bill</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="control has-icons-left has-icons-right">
                    <input class="input" type="text" placeholder="Bill No">
                    <span class="icon is-medium is-left">
                        <i class="fa fa-search"></i>
                    </span>
                    <span class="icon is-medium is-right">
                        <i class="fa fa-check"></i>
                    </span>
                </div>
            </div>
        </div>
        <div class="column">
            <div class="box">
                <div class="columns">
                    <div class="column">
                        <p class="title is-5">Search Customer</p>
                    </div>
                    <div class="column">
                        <div class="field is-grouped is-grouped-right">
                            <div class="control">
                                <a href="/customer/add" class="button is-small is-rounded is-success">
                                    <span class="icon is-small">
                                        <i class="fas fa-plus fa-xs"></i>
                                    </span>
                                    <span>New Customer</span>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="control has-icons-left has-icons-right">
                    <input class="input" type="text" placeholder="Name or Organization">
                    <span class="icon is-medium is-left">
                        <i class="fa fa-search"></i>
                    </span>
                    <span class="icon is-medium is-right">
                        <i class="fa fa-check"></i>
                    </span>
                </div>
            </div>
        </div>
    </div>
    <div class="columns">
        <div class="column">
            <div class="card">
                <header class="card-header">
                    <p class="card-header-title">
                        Rented Items
                    </p>
                    
                </header>
                <div class="card-content">
                    <div class="content">
                        <% if (bills.length > 0) { %>
                        <table class="table is-striped is-fullwidth is-hoverable">
                            <thead>
                                <tr>
                                    <th>Bill No.</th>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Rented</th>
                                    <th>Paid</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% for (let i = 0; i < bills.length; i++) { const bill = bills[i]; %>
                                <tr onclick="window.location.href =  '/billing/<%=bill.id%>'">
                                    <td><%=bill.track_id%></td>
                                    <td><%=toNepaliDate(bill.createdAt)%></td>
                                    <% if (bill.customer.organization.length == 0) { %>
                                    <td><%=bill.customer.first_name+' '+bill.customer.last_name;%></td>
                                    <% } else { %>
                                    <td><%=bill.customer.organization;%></td>
                                    <% } %>
                                    <td>
                                        <% for (let j = 0; j < bill.bill_transactions.length; j++) { const tr = bill.bill_transactions[j]; %>
                                            <p><%=tr.inventory_record.inventory.name;%></p>
                                        <% } %>
                                    </td>
                                    <% if (bill.paid) { %>
                                    <td class="has-text-success">Yes</td>
                                    <% } else { %>
                                    <td class="has-text-danger">No</td>
                                    <% } %>
                                    <td>Re. <%=bill.total.toFixed(2);%></td>
                                </tr>
                                <% } %>
                            </tbody>
                        </table>
                        <% } else { %>
                            <p class="title is-4">No Rented Items</p>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
        <div class="column">
            <div class="card">
                <header class="card-header">
                    <p class="card-header-title">
                        Unpaid Bills
                    </p>
                    
                </header>
                <div class="card-content">
                    <div class="content">
                        <%if (unpaid.length > 0) { %>
                        <table class="table is-striped is-fullwidth">
                            <thead>
                                <tr>
                                    <th>Bill No</th>
                                    <th>Date</th>
                                    <th>Customer</th>
                                    <th>Due Date</th>
                                    <th>Cost</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% for (let i = 0; i < unpaid.length; i++) { const bill = unpaid[i]; %>
                                <tr onclick="window.location.href =  '/billing/<%=bill.id%>'">
                                    <td><%=bill.track_id%></td>
                                    <td><%=toNepaliDate(bill.createdAt)%></td>
                                    <% if (bill.customer.organization.length == 0) { %>
                                    <td><%=bill.customer.first_name+' '+bill.customer.last_name;%></td>
                                    <% } else { %>
                                    <td><%=bill.customer.organization;%></td>
                                    <% } %>
                                    <% var today = new Date(); if (bill.dueDate > today) { %>
                                    <td><%=toNepaliDate(bill.dueDate)%></td>
                                    <% } else { %>
                                    <td class="has-text-danger"><%=toNepaliDate(bill.dueDate)%></td>
                                    <% } %>
                                    <td>Re. <%=bill.total.toFixed(2);%></td>
                                </tr>
                                <% } %>
                            </tbody>
                        </table>
                        <% }else{%>
                        <p class="title is-4">All Bills Paid</p>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<%include ./partials/footer %>